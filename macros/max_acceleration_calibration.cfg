[gcode_macro M201]
description: Sets maximum acceleration.
  Usage: M201 [X<accel>] [Y<accel>]
variable_max_accel: 1.7976931348623157e+308
gcode:
  {% if 'X' in params or 'Y' in params %}
    {% set accel = (params.X|default(params.Y)|float,
                    params.Y|default(params.X)|float)|min %}
    SET_GCODE_VARIABLE MACRO=M201 VARIABLE=max_accel VALUE="{accel}"
    {% if accel > printer.toolhead.max_accel %}
		{% set accel = printer.toolhead.max_accel %}
    {% endif %}
	{% set decel_ratio = printer.toolhead.max_accel_to_decel / printer.toolhead.max_accel %}
    SET_VELOCITY_LIMIT ACCEL="{accel}" ACCEL_TO_DECEL="{accel * decel_ratio}"
  {% else %}
    SET_VELOCITY_LIMIT
  {% endif %}